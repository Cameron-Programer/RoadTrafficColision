<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Road Traffic Collision</title>
        <link rel="icon" href="icon.png" type="image/png" sizes="24x24">
        <!--TODO: Replace with no-copyright icon before submition -->

        <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

        <!-- This script and link is from the leaflet tutorial -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
              integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
              crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
                integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
                crossorigin=""></script>
        <!-- This script and link is from the leaflet tutorial -->

    </head>
    <body>
        <header class="w3-blue w3-text-white w3-padding">
            <h1 style="text-align: center">Road Traffic Collision</h1>
            <form class="w3-padding" style="text-align: center" id="Filter">
                <select name="severity" class="w3-border-sand w3-padding-small">
                    <option value="0">Severity</option>
                    <option value="1">Fatal</option>
                    <option value="2">Serious</option>
                    <option value="3">Minor</option>
                </select>

                <select name="Mode" class="w3-border-sand w3-padding-small" id="mode">
                    <option value="0">Mode</option>
                    <option value="1">Car</option>
                    <option value="2">Cycle</option>
                    <option value="3">M-Cycle</option>
                    <option value="4">Pedestrian</option>
                </select>

                <button type="submit" class="w3-border-sand w3-padding-small">Filter</button>
            </form>

        </header>

        <div id="map" style="width: 800px; height: 700px">
            <script> <!-- START: This script has been modified from the leaflet quickstart guide -->
                console.log("Map Script has started....")
                // Start of Start gude script
                var map = L.map('map').setView([51.45, -2.555], 12);
                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(map);
                // End of start guide script
                console.log("Sucess!")
            </script> <!-- END:  This script has been modified from the leaflet quickstart guide -->
        </div>


            <script id="OdbToMapSc">
                function OdbToMap(json) {
                    console.log("Odb to map script has started")
                    let ownURL = document.URL;
                    let search = new URLSearchParams(ownURL);
                    console.log(search.values());

                    for (var i = 0; i != json["features"].length ; i++) {
                        //console.log(i.toString())
                        //console.log(json["features"][i]["properties"][])
                        //console.log((json["features"][i]["properties"]["SEVERITY"]));
                        //console.log((search.get("Severity")));
                       //if ((json["features"][i]["properties"]["SEVERITY"]) == (search.get("Severity")) | (search.get("Severity")) == 0){

                            let marker = L.marker([json["features"][i.toString()]["geometry"]["coordinates"]["1"], json["features"][i.toString()]["geometry"]["coordinates"]["0"]]).addTo(map);


                            marker.bindPopup(("Severity: "+(json["features"][i]["properties"]["SEVERITY_DESCRIPTION"]).toString()
                                +"<br>Description: "+(json["features"][i]["properties"]["ACCIDENT_DESCRIPTION"]).toString()
                                +"<br>Render: "+(json["features"][i]["properties"]["RENDER"]).toString()
                                +"<br>Casualties: "+(json["features"][i]["properties"]["CASUALTIES"]).toString()
                                +"<br>Accident Type: "+(json["features"][i]["properties"]["ACCIDENT_TYPE"]).toString()
                                +"<br>SEVERITY: "+(json["features"][i]["properties"]["SEVERITY"]).toString()));
                       // }
                    }
                    console.log("Sucess!")
                    return(true)
                }

            </script>

            <script id="OdbApi">
                console.log("OpenDataBristol Scrip has started...")
                let url = "https://maps2.bristol.gov.uk/server2/rest/services/ext/ll_transport/MapServer/41/query?where=1%3D1&outFields=DATE_,TIME,SEVERITY,ACCIDENT_TYPE,ACCIDENT_DESCRIPTION,RENDER,DATE_TIME_CONVERTED,SEVERITY_DESCRIPTION,CASUALTIES&outSR=4326&f=geojson"
                fetch(url,{method: 'GET', headers:{"Accept":"application/json"}})
                    .then(response => response.json())
                    .then((json) => OdbToMap(json))
                    console.log("Sucess!");
            </script>



        <footer class="w3-grey w3-text-white w3-padding">

            Â©Cameron Mackie | Ninsang Sherpa | <a href="https://opendata.bristol.gov.uk">2026 Open Data Bristol</a> <a href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/">(OGLv3)</a> | <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a><br>
            A project by first year students at <a href="https://www.uwe.ac.uk">the University of the West of England (UWE)</a> on the <a href="https://courses.uwe.ac.uk/6F3B/software-engineering">Software Eng course</a> <br>
            Contact: <a href="mailto:cameron2.mackie@live.uwe.ac.uk">Cameron2.Mackie@live.uwe.ac.uk</a> or <a href="mailto:Ninsang2.Sherpa@live.uwe.ac.uk">Ninsang2.Sherpa@live.uwe.ac.uk</a><br>
        </footer>
    </body>
</html>
